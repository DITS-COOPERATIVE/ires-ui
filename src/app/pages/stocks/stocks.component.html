
<table
  mat-table
  [dataSource]="dataSource"
  matSort
  matSortActive="name"
  matSortDisableClear
>

  <ng-container matColumnDef="select">
    <th mat-header-cell *matHeaderCellDef>
      <mat-checkbox
        (change)="$event ? masterToggle() : null"
        [checked]="isAllSelected()"
      ></mat-checkbox>
    </th>
    <td mat-cell *matCellDef="let row">
      <mat-checkbox
        (click)="$event.stopPropagation()"
        (change)="$event ? selection.toggle(row) : null"
        [checked]="selection.isSelected(row)"
      ></mat-checkbox>
    </td>
  </ng-container>


  <ng-container
    *ngFor="let column of displayedColumns; let i = index"
    [matColumnDef]="column"
  >
    <th
      mat-header-cell
      *matHeaderCellDef
      mat-sort-header
      cdkDropList
      cdkDropListOrientation="horizontal"
      (cdkDropListDropped)="drop($event)"
      mwlResizable
      [enableGhostResize]="true"
      [validateResize]="validateResize"
      (resizeEnd)="onResizeEnd($event, column)"
    >
      {{ columnHeaders[column] }}
    </th>
    <td mat-cell *matCellDef="let product">
      <ng-container *ngIf="column === 'price'">
        {{ product[column] | currency:'PHP':'symbol':'1.2-2' }}
      </ng-container>
      <ng-container *ngIf="column === 'quantity'">
        <ng-container *ngIf="editingProductId === product.id; else quantityDisplay">
          <input type="number" [(ngModel)]="product[column]" />
          <span class="check-icon me-3 text-success" (click)="saveQuantity(product)">
            <i class="fa fa-check "></i>
          </span>
          <span class="cancel-icon text-danger" (click)="cancelEdit()">
            <i class="fa fa-times"></i>
          </span>
        </ng-container>
        <ng-template #quantityDisplay>
          {{ product[column] }} <span class="pencil" matTooltip="Edit" matTooltipPosition="above" (click)="editQuantity($event, product)">
            <i class="fa fa-pencil"></i>
          </span>
        </ng-template>
      </ng-container>
      <ng-container *ngIf="column !== 'price' && column !== 'quantity'">
        {{ product[column] }}
      </ng-container>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>
<div *ngIf="!dataSource?.data?.length" class="text-center p-3">
  <p>No stock available</p>
</div>
<mat-paginator
  [pageSizeOptions]="[10, 25, 50, 100]"
  showFirstLastButtons
></mat-paginator>
